'use strict';

// jshint esversion: 6

(function () {

  var each = function each(el, cb) {
    for (var i = 0; i < el.length; i++) {
      if (cb.call(this, i, el[i]) === false) {
        break;
      }
    }
  };

  var closest = function closest(el, what) {
    var newel = el;
    what = what.toUpperCase();

    do {
      newel = newel.parentNode;

      if (!newel) {
        break;
      }
    } while (newel.nodeName !== what);

    return newel;
  };

  var Tablist = function Tablist(ul) {
    var _this = this;

    var my = this;

    this.ul = ul;
    this.lis = this.ul.getElementsByTagName('li');
    this.tabs = this.ul.querySelectorAll('[role="tab"]');

    each(this.lis, function (i, el) {
      window.console.log('Element: ', el);
      if (!el.classList.contains('active')) {
        var c = el.querySelectorAll('[role="tab"]');

        if (!c || !c.length) {
          return;
        }

        c = c[0];
        c.setAttribute('aria-selected', false);
        c = c.getAttribute('aria-controls');

        var t = document.getElementById(c);
        t.setAttribute('aria-hidden', true);
      }
    });

    var swapTab = function swapTab(which) {
      var cur = _this.ul.querySelector('[aria-selected="true"]');
      var newt = _this.ul.querySelector('[aria-controls=' + which + ']');

      if (newt.length === 0) {
        return;
      }

      if (cur.length) {
        var curb = cur.getAttribute('aria-controls');

        if (curb === which) {
          return false;
        }
      }

      var cur_target = document.querySelector('[id=' + cur.getAttribute('aria-controls') + ']');
      var new_target = document.querySelector('[id=' + newt.getAttribute('aria-controls') + ']');

      var tmp = closest(cur, 'li');
      tmp.classList.remove('active');
      cur.setAttribute('aria-selected', false);
      cur_target.setAttribute('aria-hidden', true);

      tmp = closest(newt, 'li');
      tmp.classList.add('active');
      newt.setAttribute('aria-selected', true);
      new_target.setAttribute('aria-hidden', false);
    };

    each(this.tabs, function (i, el) {
      el.addEventListener('click', function (e) {
        e.preventDefault();
        swapTab(this.getAttribute('aria-controls'));
        return false;
      }, false);
    });
  };

  window.Tablist = Tablist;
})();